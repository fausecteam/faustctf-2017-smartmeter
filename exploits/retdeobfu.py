from idaapi import *
from idc import *
from idautils import *
import re, string
import struct


tbegin = SegStart(0x412310)
tend = SegEnd(tbegin)
addr = tbegin

i = 0
while addr < tend:
    #print(GetMnem(addr))
    #print(DecodeInstruction(addr).size)
    try:
        isz = DecodeInstruction(addr).size
        addr += isz 
    except:
        addr += 1

    if GetMnem(addr) == "pop" and \
        GetMnem(addr+1) == "jmp" and \
        GetOpnd(addr, 0) == "rsi" and \
        GetOpnd(addr+1, 0)  == "rsi" :
        
            print("GOTCHA!")
            print(hex(addr))
            patch_many_bytes(addr, "\xc3" + 2 * "\x90")
            
#    i += 1
#    if i == 12:
#        break